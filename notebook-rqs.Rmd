---
title: "Results - Classes"
output: html_notebook
---
Research Questions?

RQ1. Which group of metrics are most related to inserting  bugs?

RQ2. Inside these groups, which metrics are most related to inserting  bugs?

* <b>General:</b>

```{r}
library(dplyr)
resultsGen <- read.csv(file = "/home/r4ph/results/classes/analysis/resume/resultsGeneral.csv", stringsAsFactors = FALSE)
#resultsGen <- rbind(resultsGen,colSums(Filter(is.numeric, resultsGen)))
resultsGen <- resultsGen[order(-resultsGen$numberofPosGranger),]
total <- c(10, "Total", sum(resultsGen$numberofClasses), sum(resultsGen$numberofGranger), sum(resultsGen$numberofPosGranger), median(resultsGen$PercGranger))
resultsGen <- rbind(resultsGen, total)
resultsGen$X <- resultsGen$PercGranger <- NULL
resultsGen
#summary(resultsGen)
```

* <b>Add/Del Groups:</b>

```{r}
resultsGroups <- read.csv(file = "/home/r4ph/results/classes/analysis/resume/resultsAddDel.csv", stringsAsFactors = FALSE)
#resultsGen <- rbind(resultsGen,colSums(Filter(is.numeric, resultsGen)))
resultsGroups <- resultsGroups[order(-resultsGroups$numberofPosGranger),]
total <- c(10, "Total", "Total", sum(resultsGroups$numberofClasses), sum(resultsGroups$numberofGranger), sum(resultsGroups$numberofPosGranger), median(resultsGroups$PercGranger))
resultsGroups <- rbind(resultsGroups, total)
resultsGroups$X <- resultsGroups$PercGranger <- NULL
resultsGroups
#summary(resultsGroups)
```

* <b>Summarizing the metrics by groups of type changes: </b>

```{r}
resultsGroupsSum <- read.csv(file = "/home/r4ph/results/classes/analysis/resume/resultsAddDel.csv", stringsAsFactors = FALSE)
dat.grp <- group_by(resultsGroupsSum, changeTypes.j. )
dataSum <- summarise(dat.grp, NClasses=sum(numberofClasses), NGranger = sum(numberofGranger), NPosGranger = sum(numberofPosGranger))
dataSum$Perc <- NULL
dataSum
```
####Escrever Conclusões


* <b>Groups of metric types:</b>

```{r}
resultsGrp <- read.csv(file = "/home/r4ph/results/classes/analysis/resume/resultsGroups.csv", stringsAsFactors = FALSE)
resultsGrp <- resultsGrp[order(-resultsGrp$numberofPosGranger),]
total <- c(10, "Total", "Total", "Total", sum(resultsGrp$numberofClasses), sum(resultsGrp$numberofGranger), sum(resultsGrp$numberofPosGranger), median(resultsGrp$PercGranger))
resultsGrp <- rbind(resultsGrp, total)
resultsGrp$X <- resultsGrp$PercGranger <- NULL
resultsGrp
#summary(resultsGroups)
```

* <b>Summarizing the groups of metrics types: </b>

```{r}
resultsGroupsMetrics <- read.csv(file = "/home/r4ph/results/classes/analysis/resume/resultsGroups.csv", stringsAsFactors = FALSE)
dat.grp.met <- group_by(resultsGroupsMetrics, groups.x.)
dataSumMet <- summarise(dat.grp.met, NClasses=sum(numberofClasses), NGranger = sum(numberofGranger), NPosGranger = sum(numberofPosGranger))
dataSumMet$Perc <- NULL
dataSumMet <- dataSumMet[order(-dataSumMet$NPosGranger),]
dataSumMet
```

* <b> Individual Metrics: </b>

```{r}
resultsInd <- read.csv(file = "/home/r4ph/results/classes/analysis/resume/resultsMetrics.csv", stringsAsFactors = FALSE)
resultsInd <- filter(resultsInd, numberofPosGranger != 0)
resultsInd <- resultsInd[order(-resultsInd$numberofPosGranger),]
total <- c(10, "Total", "Total", "Total", sum(resultsInd$numberofClasses), sum(resultsInd$numberofGranger), sum(resultsInd$numberofPosGranger), median(resultsInd$PercGranger))
resultsInd <- rbind(resultsInd, total)
resultsInd$X <- resultsInd$PercGranger <- NULL
resultsInd
```

* <b> Summarizing ind. metrics: </b>

```{r}
resultsIndMetrics <- read.csv(file = "/home/r4ph/results/classes/analysis/resume/resultsMetrics.csv", stringsAsFactors = FALSE)
dat.grp.ind <- group_by(resultsIndMetrics, metrics.x.)
dataSumInd <- summarise(dat.grp.ind, NClasses=sum(numberofClasses), NGranger = sum(numberofGranger), NPosGranger = sum(numberofPosGranger))
dataSumInd$Perc <- NULL
dataSumInd <- dataSumInd[order(-dataSumInd$NPosGranger),]
dataSumInd
```


RQ3. Is a variability of changes metrics more conducive to introduce a bug than specific metrics? 

<b>General Questions?</b>

G1.Which group of metrics are most related to inserting bugs? By addition and removal?

Tiveram mais casos positivos de granger em mudanças relacionadas a adição de métricas. ressaltando que quanto menor o nível de granularidade, maior o aumento da diferença entre a ocorrência de bugs. Porém isso está ligado ao numero absoluto da quantidade. Uma analise relativa demonstra que não há diferença relevante, visto que há somente os seguintes percentuais:

* Changes:

Add: 0.02272022%

Del: 0.022104%

* Groups:

Add:0.007468326%

Del:0.008453847%

* Ind:

Add:0.00680984%

Del:0.006814232%

G2.Has any difference between granularity levels ?

Quanto mais alto o nível de granularidade (métricas individuais) maior a quantidade de casos positivos dos casos analisados. Contudo, como pode ser visto a diferença relativa entre os diferentes nívels de granularidade é bem baixa.

G3.Average number of commits of cases with positive cases of granger;

```{r}
filenames=list.files(path="/home/r4ph/results/classes/analysis/general", full.names=TRUE, recursive = TRUE)
results <- do.call(rbind,lapply(filenames,read.csv))
resultsTimes <- data.frame(lapply(results, as.character), stringsAsFactors=FALSE)
for (i in 1:nrow(resultsTimes)){
  resultsTimes$NtimeofCommits[i] <- length(as.list(strsplit(resultsTimes$timeofCommits[i], ","))[[1]])
}

#par(mfrow = c(2,2), cex = 1.5)

boxplot(resultsTimes$NtimeofCommits ~ resultsTimes$Project, las =2 ,par(mar = c(12, 5, 4, 2)+ 0.1), 
        main = "Boxplot of General Results", ylab = "Number of Commits Times", ylim = c(0, 20))
```

```{r}
filenames=list.files(path="/home/r4ph/results/classes/analysis/typeChange", full.names=TRUE, recursive = TRUE)
results <- do.call(rbind,lapply(filenames,read.csv))
resultsTimes <- data.frame(lapply(results, as.character), stringsAsFactors=FALSE)
for (i in 1:nrow(resultsTimes)){
  resultsTimes$NtimeofCommits[i] <- length(as.list(strsplit(resultsTimes$timeofCommits[i], ","))[[1]])
}

#par(mfrow = c(2,2), cex = 1.5)

boxplot(resultsTimes$NtimeofCommits ~ resultsTimes$Project, las =2 ,par(mar = c(12, 5, 4, 2)+ 0.1), 
        main = "Boxplot of General Results", ylab = "Number of Commits Times", ylim = c(0, 20))

```


G4.How many time series pass the preconditions related to defects (preconditions P1, P2, P3)?

#### @TODO

G5.How many time series pass the preconditions related to source code metrics (preconditions P4 and P5)? 

#### @TODO

G6.What is the number of defects potentially covered by our approach?

#### @TODO

G7.What are the lags that most led to positive results regarding Granger-causality? 

#### @TODO

<b>Observations</b>

* Analyze the DGC / defects
* Our study defines that time series of bugs is linked to the last insertion point. The previus studies is linked to the commit report.
* Insert recall and precision of model?